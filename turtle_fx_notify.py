# -*- coding: utf-8 -*-
"""Untitled0.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1OcumFWSeb-geZ5i8ZKcpb4xQgxkyrn7H
"""

print("Hello, Turtle!")

# å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆåˆå›ã ã‘å¿…è¦ï¼‰


# ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã¿
import yfinance as yf
import pandas as pd
import matplotlib.pyplot as plt

# USDJPYï¼ˆãƒ‰ãƒ«å††ï¼‰ã®éå»30æ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
data = yf.download("JPY=X", period="30d", interval="1d")

# ãƒ‡ãƒ¼ã‚¿ã®æœ€åˆã®5è¡Œã‚’è¡¨ç¤º
print(data.head())

# çµ‚å€¤ï¼ˆCloseï¼‰ã®ãƒãƒ£ãƒ¼ãƒˆã‚’æç”»
data["Close"].plot(title="USD/JPY - éå»30æ—¥é–“ã®çµ‚å€¤ãƒãƒ£ãƒ¼ãƒˆ")
plt.xlabel("æ—¥ä»˜")
plt.ylabel("å††")
plt.grid(True)
plt.show()

# 20æ—¥é–“ã®æœ€é«˜å€¤ã¨æœ€å®‰å€¤ã‚’è¨ˆç®—ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ 
data["20æ—¥é«˜å€¤"] = data["High"].rolling(window=20).max()
data["20æ—¥å®‰å€¤"] = data["Low"].rolling(window=20).min()

# æœ€æ–°ã®ãƒ­ãƒ¼ã‚½ã‚¯è¶³ã¨ã€20æ—¥é«˜å€¤ãƒ»å®‰å€¤ã‚’è¡¨ç¤º
latest = data.iloc[-1]
print("ğŸ“… æ—¥ä»˜:", latest.name.date())
print("ğŸ“ˆ çµ‚å€¤ï¼ˆCloseï¼‰:", latest["Close"])
print("ğŸ”º 20æ—¥é–“ã®é«˜å€¤:", latest["20æ—¥é«˜å€¤"])
print("ğŸ”» 20æ—¥é–“ã®å®‰å€¤:", latest["20æ—¥å®‰å€¤"])

import requests

# ã‚ãªãŸã®Webhook URLã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼ˆ""ã®ä¸­ã ã‘ï¼‰
SLACK_WEBHOOK_URL = "https://hooks.slack.com/services/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"

# Slackã«é€šçŸ¥ã‚’é€ã‚‹é–¢æ•°
def send_slack_message(message):
    payload = {"text": message}
    response = requests.post(SLACK_WEBHOOK_URL, json=payload)
    if response.status_code == 200:
        print("âœ… Slackã«é€šçŸ¥ã‚’é€ã‚Šã¾ã—ãŸï¼")
    else:
        print(f"âŒ ã‚¨ãƒ©ãƒ¼: {response.status_code}, {response.text}")

# ãƒ†ã‚¹ãƒˆé€šçŸ¥ã‚’é€ã£ã¦ã¿ã‚‹
send_slack_message("ğŸ“¢ ãƒ†ã‚¹ãƒˆé€šçŸ¥ã§ã™ï¼Colabã‹ã‚‰Slackã«é€ä¿¡æˆåŠŸï¼")

# å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆåˆå›ã®ã¿ï¼‰
!pip install yfinance pandas requests

# ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿
import yfinance as yf
import pandas as pd
import requests
from datetime import datetime

# Slack Webhook URLï¼ˆã‚ãªãŸã®ã«å·®ã—æ›¿ãˆã¦ãã ã•ã„ï¼‰
SLACK_WEBHOOK_URL = "https://hooks.slack.com/services/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"

# Slackã«é€šçŸ¥ã‚’é€ã‚‹é–¢æ•°
def send_slack_message(message):
    payload = {"text": message}
    response = requests.post(SLACK_WEBHOOK_URL, json=payload)
    if response.status_code == 200:
        print("âœ… Slacké€šçŸ¥ã‚’é€ã‚Šã¾ã—ãŸ")
    else:
        print(f"âŒ é€šçŸ¥å¤±æ•—: {response.status_code} - {response.text}")

# é€šè²¨ãƒšã‚¢è¨­å®šï¼ˆYahoo Financeã§USD/JPYã¯ "JPY=X"ï¼‰
symbol = "JPY=X"
name = "USD/JPY"

# ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆéå»30æ—¥ã€1æ—¥è¶³ï¼‰
data = yf.download(symbol, period="30d", interval="1d")
data.dropna(inplace=True)  # æ¬ æå€¤ã‚’å‰Šé™¤

# é«˜å€¤ãƒ»å®‰å€¤ã®ãƒ–ãƒ¬ã‚¤ã‚¯åˆ¤å®š
data["20æ—¥é«˜å€¤"] = data["High"].rolling(window=20).max()
data["20æ—¥å®‰å€¤"] = data["Low"].rolling(window=20).min()

latest = data.iloc[-1]
today = latest.name.date()
close = latest["Close"]
high_20 = latest["20æ—¥é«˜å€¤"]
low_20 = latest["20æ—¥å®‰å€¤"]

# ã‚·ã‚°ãƒŠãƒ«åˆ¤å®š
signal = None
if close > high_20:
    signal = "ğŸ“ˆ è²·ã„ã‚µã‚¤ãƒ³"
elif close < low_20:
    signal = "ğŸ“‰ å£²ã‚Šã‚µã‚¤ãƒ³"
else:
    signal = "â³ ãƒãƒ¼ã‚µã‚¤ãƒ³ï¼ˆä¿ç•™ï¼‰"

# Slacké€šçŸ¥æœ¬æ–‡ä½œæˆ
message = f"""
ğŸ“Š ã‚¿ãƒ¼ãƒˆãƒ«ã‚ºæˆ¦ç•¥é€šçŸ¥
--------------------------
é€šè²¨ãƒšã‚¢ï¼š{name}
æ—¥ä»˜ï¼š{today}
ç¾åœ¨ä¾¡æ ¼ï¼š{round(close, 3)}
20æ—¥é«˜å€¤ï¼š{round(high_20, 3)}
20æ—¥å®‰å€¤ï¼š{round(low_20, 3)}
ã‚·ã‚°ãƒŠãƒ«ï¼š{signal}
"""

# é€šçŸ¥é€ä¿¡
send_slack_message(message)

# å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆåˆå›ã®ã¿ï¼‰
!pip install yfinance pandas requests

# ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿
import yfinance as yf
import pandas as pd
import requests
from datetime import datetime

# Slack Webhook URLï¼ˆã‚ãªãŸã®ã«å·®ã—æ›¿ãˆã¦ãã ã•ã„ï¼‰
SLACK_WEBHOOK_URL = "https://hooks.slack.com/services/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"

# Slackã«é€šçŸ¥ã‚’é€ã‚‹é–¢æ•°
def send_slack_message(message):
    payload = {"text": message}
    response = requests.post(SLACK_WEBHOOK_URL, json=payload)
    if response.status_code == 200:
        print("âœ… Slacké€šçŸ¥ã‚’é€ã‚Šã¾ã—ãŸ")
    else:
        print(f"âŒ é€šçŸ¥å¤±æ•—: {response.status_code} - {response.text}")

# é€šè²¨ãƒšã‚¢è¨­å®šï¼ˆYahoo Financeã§USD/JPYã¯ "JPY=X"ï¼‰
symbol = "JPY=X"
name = "USD/JPY"

# ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆéå»30æ—¥ã€1æ—¥è¶³ï¼‰
data = yf.download(symbol, period="30d", interval="1d")
data.dropna(inplace=True)  # æ¬ æå€¤ã‚’å‰Šé™¤

# é«˜å€¤ãƒ»å®‰å€¤ã®ãƒ–ãƒ¬ã‚¤ã‚¯åˆ¤å®š
data["20æ—¥é«˜å€¤"] = data["High"].rolling(window=20).max()
data["20æ—¥å®‰å€¤"] = data["Low"].rolling(window=20).min()

latest = data.iloc[-1]
today = latest.name.date()
close = latest["Close"]
high_20 = latest["20æ—¥é«˜å€¤"]
low_20 = latest["20æ—¥å®‰å€¤"]

# ã‚·ã‚°ãƒŠãƒ«åˆ¤å®š
signal = None
if close > high_20:
    signal = "ğŸ“ˆ è²·ã„ã‚µã‚¤ãƒ³"
elif close < low_20:
    signal = "ğŸ“‰ å£²ã‚Šã‚µã‚¤ãƒ³"
else:
    signal = "â³ ãƒãƒ¼ã‚µã‚¤ãƒ³ï¼ˆä¿ç•™ï¼‰"

# Slacké€šçŸ¥æœ¬æ–‡ä½œæˆ
message = f"""
ğŸ“Š ã‚¿ãƒ¼ãƒˆãƒ«ã‚ºæˆ¦ç•¥é€šçŸ¥
--------------------------
é€šè²¨ãƒšã‚¢ï¼š{name}
æ—¥ä»˜ï¼š{today}
ç¾åœ¨ä¾¡æ ¼ï¼š{round(close, 3)}
20æ—¥é«˜å€¤ï¼š{round(high_20, 3)}
20æ—¥å®‰å€¤ï¼š{round(low_20, 3)}
ã‚·ã‚°ãƒŠãƒ«ï¼š{signal}
"""

# é€šçŸ¥é€ä¿¡
send_slack_message(message)

import yfinance as yf
import pandas as pd
import requests
from datetime import datetime

# Slack Webhookï¼ˆâ†è‡ªåˆ†ã®ã«å·®ã—æ›¿ãˆã¦ã­ï¼ï¼‰
SLACK_WEBHOOK_URL = "https://hooks.slack.com/services/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"

def send_slack_message(message):
    payload = {"text": message}
    response = requests.post(SLACK_WEBHOOK_URL, json=payload)
    if response.status_code == 200:
        print("âœ… Slackã«é€šçŸ¥ã‚’é€ã‚Šã¾ã—ãŸ")
    else:
        print(f"âŒ é€šçŸ¥å¤±æ•—: {response.status_code} - {response.text}")

# é€šè²¨ãƒšã‚¢ï¼šUSD/JPYï¼ˆYahoo Financeã¯ JPY=Xï¼‰
symbol = "JPY=X"
name = "USD/JPY"

# ãƒ‡ãƒ¼ã‚¿å–å¾—
data = yf.download(symbol, period="30d", interval="1d")
data.dropna(inplace=True)

# 20æ—¥é«˜å€¤ãƒ»å®‰å€¤ã‚’è¨ˆç®—
data["20æ—¥é«˜å€¤"] = data["High"].rolling(window=20).max()
data["20æ—¥å®‰å€¤"] = data["Low"].rolling(window=20).min()

# æœ€æ–°è¡Œã ã‘å–å¾—ï¼ˆ20æ—¥ç›®ä»¥é™ã§ãªã„ã¨å€¤ãŒNaNï¼‰
latest = data.dropna().iloc[-1]
today = latest.name.date()
close = latest["Close"]
high_20 = latest["20æ—¥é«˜å€¤"]
low_20 = latest["20æ—¥å®‰å€¤"]

# ã‚·ã‚°ãƒŠãƒ«åˆ¤å®š
if close > high_20:
    signal = "ğŸ“ˆ è²·ã„ã‚µã‚¤ãƒ³"
elif close < low_20:
    signal = "ğŸ“‰ å£²ã‚Šã‚µã‚¤ãƒ³"
else:
    signal = "â³ ãƒãƒ¼ã‚µã‚¤ãƒ³ï¼ˆä¿ç•™ï¼‰"

# Slacké€šçŸ¥ã®æœ¬æ–‡
message = f"""
ğŸ“Š ã‚¿ãƒ¼ãƒˆãƒ«ã‚ºæˆ¦ç•¥é€šçŸ¥
--------------------------
é€šè²¨ãƒšã‚¢ï¼š{name}
æ—¥ä»˜ï¼š{today}
ç¾åœ¨ä¾¡æ ¼ï¼š{round(close, 3)}
20æ—¥é«˜å€¤ï¼š{round(high_20, 3)}
20æ—¥å®‰å€¤ï¼š{round(low_20, 3)}
ã‚·ã‚°ãƒŠãƒ«ï¼š{signal}
"""

# é€šçŸ¥ã‚’é€ä¿¡ï¼
send_slack_message(message)

import yfinance as yf
import pandas as pd
import requests
from datetime import datetime

# Slack Webhookï¼ˆè‡ªåˆ†ã®ã«å¤‰ãˆã¦ã­ï¼‰
SLACK_WEBHOOK_URL = "https://hooks.slack.com/services/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"

def send_slack_message(message):
    payload = {"text": message}
    response = requests.post(SLACK_WEBHOOK_URL, json=payload)
    if response.status_code == 200:
        print("âœ… Slackã«é€šçŸ¥ã‚’é€ã‚Šã¾ã—ãŸ")
    else:
        print(f"âŒ é€šçŸ¥å¤±æ•—: {response.status_code} - {response.text}")

# é€šè²¨ãƒšã‚¢è¨­å®š
symbol = "JPY=X"
name = "USD/JPY"

# ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆ30æ—¥åˆ†ï¼‰
data = yf.download(symbol, period="30d", interval="1d")
data.dropna(inplace=True)

# é«˜å€¤ãƒ»å®‰å€¤ã®è¨ˆç®—
data["20æ—¥é«˜å€¤"] = data["High"].rolling(window=20).max()
data["20æ—¥å®‰å€¤"] = data["Low"].rolling(window=20).min()

# æœ€æ–°ã®è¡Œï¼ˆ20æ—¥åˆ†æƒã£ãŸæœ€çµ‚è¡Œï¼‰
latest_row = data.dropna().iloc[-1]
today = latest_row.name.date()
close = latest_row["Close"]
high_20 = latest_row["20æ—¥é«˜å€¤"]
low_20 = latest_row["20æ—¥å®‰å€¤"]

# æ•°å€¤ã«å¤‰æ›ï¼ˆâ†ã“ã“ãŒãƒã‚¤ãƒ³ãƒˆï¼ï¼‰
close = float(close)
high_20 = float(high_20)
low_20 = float(low_20)

# ã‚·ã‚°ãƒŠãƒ«åˆ¤å®š
if close > high_20:
    signal = "ğŸ“ˆ è²·ã„ã‚µã‚¤ãƒ³"
elif close < low_20:
    signal = "ğŸ“‰ å£²ã‚Šã‚µã‚¤ãƒ³"
else:
    signal = "â³ ãƒãƒ¼ã‚µã‚¤ãƒ³ï¼ˆä¿ç•™ï¼‰"

# Slacké€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
message = f"""
ğŸ“Š ã‚¿ãƒ¼ãƒˆãƒ«ã‚ºæˆ¦ç•¥é€šçŸ¥
--------------------------
é€šè²¨ãƒšã‚¢ï¼š{name}
æ—¥ä»˜ï¼š{today}
ç¾åœ¨ä¾¡æ ¼ï¼š{round(close, 3)}
20æ—¥é«˜å€¤ï¼š{round(high_20, 3)}
20æ—¥å®‰å€¤ï¼š{round(low_20, 3)}
ã‚·ã‚°ãƒŠãƒ«ï¼š{signal}
"""

# é€šçŸ¥é€ä¿¡
send_slack_message(message)

